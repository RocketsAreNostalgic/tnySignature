(function(i){const n={frame:null,elements:{uploadButton:null,removeButton:null,imagePreview:null,imageIdInput:null,form:null},settings:{defaultImage:"",title:"Select or Upload Signature Image",buttonText:"Use this image",multiple:!1},init(e){this.settings=i.extend(this.settings,e||{}),this.elements.uploadButton=i("#uploadimage"),this.elements.removeButton=i("#removeimage"),this.elements.imagePreview=i("#signature-image-preview"),this.elements.imageIdInput=i("#user_signature_image_id"),this.elements.form=this.elements.imageIdInput.closest("form"),this.updateButtonState(),this.bindEvents()},bindEvents(){this.elements.uploadButton.on("click",this.openMediaUploader.bind(this)),this.elements.removeButton.on("click",this.removeImage.bind(this))},updateButtonState(){const e=!!this.elements.imageIdInput.val();this.elements.removeButton.prop("disabled",!e)},openMediaUploader(e){if(e.preventDefault(),this.frame){this.frame.open();return}this.frame=wp.media({title:this.settings.title,button:{text:this.settings.buttonText},library:{type:"image"},multiple:this.settings.multiple});const t=this.elements.imageIdInput.val();if(t){const a=this.frame.state().get("selection"),s=wp.media.attachment(t);s.fetch(),a.add(s?[s]:[])}this.frame.on("select",this.handleImageSelection.bind(this)),this.frame.open()},handleImageSelection(){const e=this.frame.state().get("selection").first().toJSON();this.elements.imageIdInput.val(e.id),this.updateImagePreview(e),this.updateButtonState(),this.elements.imageIdInput.trigger("change")},updateImagePreview(e){let t;e.sizes&&e.sizes.medium?t=e.sizes.medium.url:t=e.url,this.elements.imagePreview.attr({src:t,alt:e.alt||e.title||"Signature image"})},removeImage(e){e.preventDefault(),this.elements.imageIdInput.val()&&(this.elements.imageIdInput.val(""),this.elements.imagePreview.attr({src:this.settings.defaultImage,srcset:"",alt:"Default placeholder image"}),this.updateButtonState(),this.elements.imageIdInput.trigger("change"))}};i(document).ready(function(){const e=i("#uploadimage"),t={title:e.data("title")||TNYSINGNATURE.i18n.title,buttonText:e.data("button")||TNYSINGNATURE.i18n.button,multiple:e.data("multiple")===!0,defaultImage:TNYSINGNATURE.sigurl+"assets/img/question.png"};n.init(t)})})(jQuery);
